<div class="container-detailsproduct">
<section class="product-details">
  <p class="section-title">
    <i class="fa-solid fa-fish-fins icon"></i> 
    Tableau des détails des produits
  </p>

  <div class="product-info">
    <p>
      Cette section vous permet de consulter les détails des produits en stock, incluant les catégories, les prix, et les quantités disponibles. Utilisez les filtres ci-dessous pour affiner vos recherches.
    </p>
  </div>
</section>

<!-- Filtre -->
<div class="filter-container">
  <h4 class="filter-title">Filtrer par Catégorie :</h4>
  <div class="chip-list" aria-label="Category selection">
    <div
      class="filter-chip"
      *ngFor="let category of categories"
      [class.selected]="selectedCategory === category.id"
      (click)="filterByCategory(category.id)">
      {{ category.name }}
    </div>
  </div>
</div>

<!-- Table -->
<table mat-table [dataSource]="productsList" class="mat-elevation-z8 demo-table shadow-light animated-table">
    <ng-container matColumnDef="name">
        <th class="vertical-line --primary-blue-title" mat-header-cell *matHeaderCellDef>Name</th>
        <td class="vertical-line" mat-cell *matCellDef="let product" [style.border]="!product.name ? '1px solid #bf1717' : ''" [attr.title]="!product.name ? 'Errrrreuur' : null">
            <ng-container>
                {{ product.name }}
            </ng-container>
        </td>
    </ng-container>

    <ng-container matColumnDef="price">
        <th class="vertical-line text-center --primary-blue-title" mat-header-cell *matHeaderCellDef>Price</th>
        <td class="vertical-line text-center" mat-cell *matCellDef="let product" [style.border]="product.price < 0 ? '1px solid #bf1717' : ''" [attr.title]="product.price < 0 ? 'Errrrreuur' : null">
            <ng-container *ngIf="!product.isEditing; else editField">
            {{ product.price }}
            </ng-container>
            <ng-template #editField>
            <form (submit)="saveProduct(product); toggleEditMode(product)">
                <input type="number" class="width-input-max" [(ngModel)]="product.price" name="price" required>
            </form>
            </ng-template>
        </td>
    </ng-container>

    <ng-container matColumnDef="sale">
        <th class="vertical-line text-center --primary-blue-title" mat-header-cell *matHeaderCellDef>sale</th>
        <td class="vertical-line text-center" mat-cell *matCellDef="let product">
            <ng-container>
            {{ product.sale }}
            </ng-container>
        </td>
    </ng-container>

    <ng-container matColumnDef="discount">
        <th class="vertical-line text-center --primary-blue-title" mat-header-cell *matHeaderCellDef>discount</th>
        <td class="vertical-line text-center" mat-cell *matCellDef="let product" [style.border]="(product.discount < 0 || product.discount > 100) ? '1px solid #bf1717' : ''" [attr.title]="(product.discount < 0 || product.discount > 100) ? 'Errrrreuur' : null">
            <ng-container *ngIf="!product.isEditing; else editField">
                {{product.discount}}%
            </ng-container>
            <ng-template #editField>
            <form (submit)="saveProduct(product); toggleEditMode(product)" style="display: flex;">
                <input type="number" class="width-input-max" [(ngModel)]="product.discount" name="discount" required>
                <span *ngIf="product.isEditing">%</span>
            </form>
            </ng-template>
        </td>
    </ng-container>
    <ng-container matColumnDef="price_on_sale">
        <th  class="vertical-line text-center --primary-blue-title" mat-header-cell  *matHeaderCellDef>price_on_sale</th>
        <td  class="vertical-line text-center" mat-cell *matCellDef="let product" >
            <ng-container >
            {{calculatePercentageDiscount(product)}}
            </ng-container>
        </td>
    </ng-container>

    <ng-container matColumnDef="quantityInStock">
        <th class="vertical-line text-center --primary-blue-title" mat-header-cell *matHeaderCellDef>quantityInStock</th>
        <td class="vertical-line text-center" mat-cell *matCellDef="let product">
            <ng-container *ngIf="!product.isEditing; else editField">
            {{ product.quantityInStock }}

            </ng-container>
            <ng-template #editField>
            <form (submit)="saveProduct(product); toggleEditMode(product)">
                <input type="number" class="width-input-max" [(ngModel)]="product.quantityInStock" [value]="quantityInStock" name="quantityInStock" required>
            </form>
            </ng-template>
        </td>
    </ng-container>

    <!-- <ng-container matColumnDef="quantity_sold">
        <th class="vertical-line text-center --primary-blue-title" mat-header-cell *matHeaderCellDef>quantity_sold</th>
        <td class="vertical-line text-center" mat-cell *matCellDef="let product">
        <ng-container *ngIf="!product.isEditing; else editField">
            {{ product.quantity_sold }}

        </ng-container>
        <ng-template #editField>
            <form (submit)="saveProduct(product); toggleEditMode(product)">
            <input type="number" class="width-input-max" [(ngModel)]="product.quantity_sold" name="quantity_sold" required>
            </form>
        </ng-template>
        </td>
    </ng-container> -->

    <ng-container matColumnDef="comments">
        <th class="vertical-line text-center --primary-blue-title" mat-header-cell *matHeaderCellDef>comments</th>
        <td class="vertical-line" mat-cell *matCellDef="let product">
        <ng-container >
            {{ product.comments }}
        </ng-container>
        </td>
    </ng-container>


    <ng-container matColumnDef="edit">
        <th class="vertical-line text-center --primary-blue-title font-weight-bold" mat-header-cell *matHeaderCellDef>#</th>
        <td class="vertical-line text-center" mat-cell *matCellDef="let product">
        <ng-container *ngIf="product.isEditing; else editField">
            <!-- Bouton "Save" -->
            <form (submit)="saveProduct(product); toggleEditMode(product)">
                <div style="display: flex;">
                <button class="transparent-button" type="submit"><mat-icon style="color: #2aa053;">save</mat-icon></button>
                <button class="transparent-button"  type="button" (click)="toggleEditMode(product)"><mat-icon style="color: #585958;">cancel</mat-icon></button>
            </div>
            </form>
        </ng-container>
        <ng-template #editField>
            <!-- Bouton "Edit" -->
            <button mat-button class="transparent-button" aria-label="Example icon button with a home icon" (click)="toggleEditMode(product)">
            <mat-icon class="blue-icon">edit</mat-icon>
            </button>


        </ng-template>
        </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="[ 'name', 'price','sale', 'discount','price_on_sale',  'quantityInStock', 'comments' ,'edit',]"></tr>
    <tr mat-row *matRowDef="let row; columns: [ 'name', 'price','sale', 'discount', 'price_on_sale', 'quantityInStock', 'comments' ,'edit',]"></tr>
</table>
</div>
